# Nixpacks Configuration for Fahras API (Laravel 11)
# Deployed as separate backend service on Cranl.com PaaS

[phases.setup]
nixPkgs = [
    "php83",
    "php83Packages.composer",
    "php83Extensions.pdo",
    "php83Extensions.pdo_pgsql",
    "php83Extensions.pgsql",
    "php83Extensions.redis",
    "php83Extensions.mbstring",
    "php83Extensions.xml",
    "php83Extensions.dom",
    "php83Extensions.curl",
    "php83Extensions.fileinfo",
    "php83Extensions.tokenizer",
    "php83Extensions.ctype",
    "php83Extensions.openssl",
    "php83Extensions.bcmath",
    "php83Extensions.pcntl",
    "php83Extensions.intl",
    "php83Extensions.gd",
    "php83Extensions.exif",
    "php83Extensions.zip",
    "caddy"
]

[phases.install]
dependsOn = ["setup"]
cmds = [
    "mkdir -p bootstrap/cache storage/framework/{cache,sessions,views} storage/logs storage/app/public",
    "chmod -R 775 storage bootstrap/cache",
    "composer install --no-dev --optimize-autoloader --no-interaction --ignore-platform-req=ext-redis"
]

[start]
cmd = "bash deploy-entrypoint.sh"
