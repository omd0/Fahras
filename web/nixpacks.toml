# =============================================================================
# Fahras Web — NixPacks Configuration
# React 19 · TypeScript · Vite · MUI v7
# =============================================================================
#
# Deploy on Railway, Render, Coolify, or any NixPacks-compatible PaaS.
#
# Required environment variables (set in your platform dashboard):
#   VITE_API_URL  — Backend API URL (https://api.example.com/api)
#   VITE_APP_NAME — Application display name (default: Fahras)
#
# Optional:
#   PORT          — Server listen port (default: 3000)
# =============================================================================

providers = ["node"]

# ---------------------------------------------------------------------------
# Build-time environment
# ---------------------------------------------------------------------------
[variables]
NODE_ENV                = "production"
CI                      = "false"
NIXPACKS_NODE_VERSION   = "20"

# ---------------------------------------------------------------------------
# Phase: setup — Node.js runtime
# ---------------------------------------------------------------------------
[phases.setup]
nixPkgs = ["nodejs_20"]

# ---------------------------------------------------------------------------
# Phase: install — npm dependencies
# ---------------------------------------------------------------------------
[phases.install]
dependsOn = ["setup"]
cmds = ["npm ci --prefer-offline --no-audit"]
cacheDirectories = ["node_modules", ".npm"]

# ---------------------------------------------------------------------------
# Phase: build — TypeScript check + Vite production bundle
# ---------------------------------------------------------------------------
[phases.build]
dependsOn = ["install"]
cmds = ["npm run build"]

# ---------------------------------------------------------------------------
# Start command — static file server with SPA fallback
# ---------------------------------------------------------------------------
# Serves the Vite output from build/ with --single for React Router
# client-side routing (all paths → index.html).
# ---------------------------------------------------------------------------
[start]
cmd = "npx --yes serve build --single --listen tcp://0.0.0.0:${PORT:-3000}"
